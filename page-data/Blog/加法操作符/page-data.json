{"componentChunkName":"component---src-templates-post-post-js","path":"/Blog/加法操作符/","webpackCompilationHash":"9b2619a88bc10fca86fe","result":{"data":{"markdownRemark":{"id":"effb6a2d-7930-52dd-b892-74846e7dc383","excerpt":"date: 2018-09-18 引子 +操作符规则 题目解析 引子 JavaScript上手快…","html":"<ul>\n<li>\n<p><a href=\"#date-2018-09-18\">date: 2018-09-18</a></p>\n<ul>\n<li><a href=\"#%E5%BC%95%E5%AD%90\">引子</a></li>\n<li><a href=\"#%E6%93%8D%E4%BD%9C%E7%AC%A6%E8%A7%84%E5%88%99\">+操作符规则</a></li>\n<li><a href=\"#%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90\">题目解析</a></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"引子\"><a href=\"#%E5%BC%95%E5%AD%90\" aria-label=\"引子 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>引子</h4>\n<p><code>JavaScript</code>上手快 1 年了，今天无意刷到了几道传统面试题，无法有条理的给出答案，顿感基础薄弱。 这几道题都是关于加法操作符的知识点，先上面试例题：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token number\">1.</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">//''</span>\n\n<span class=\"token number\">2.</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token comment\">//'[object Object]'</span>\n\n<span class=\"token number\">3.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token comment\">//0</span>\n\n<span class=\"token number\">4.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token comment\">//'[object Object][object Object]'</span></code></pre></div>\n<p>下面先总结加法操作符规则，之后按照总结的计算规则，依次解题。</p>\n<h4 id=\"操作符规则\"><a href=\"#%E6%93%8D%E4%BD%9C%E7%AC%A6%E8%A7%84%E5%88%99\" aria-label=\"操作符规则 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>+操作符规则</h4>\n<p>\"+\"作为二元操作符，完成表达式<code>x+y</code>中 2 个变量数值相加或字符串拼接，具体规则如下所示：</p>\n<ol>\n<li>如果 x, y 至少有一个为对象，将其转换为基本类型</li>\n<li>转换后如果 x, y 至少有一个为<code>string</code>，则将另一个转换为<code>string</code>，执行字符串拼接</li>\n<li>以上均不满足，将 x, y 转换为<code>number</code>，执行数值计算</li>\n</ol>\n<h5 id=\"---omit-in-toc----对象转换为基本类型规则\"><a href=\"#---omit-in-toc----%E5%AF%B9%E8%B1%A1%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E8%A7%84%E5%88%99\" aria-label=\"   omit in toc    对象转换为基本类型规则 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><!-- omit in toc --> 对象转换为基本类型规则</h5>\n<ol>\n<li>如果 x 是<code>Date</code>对象,返回<code>x.toString()</code></li>\n<li>如果 x 是其他对象，且<code>x.valueOf()</code>返回值为基本类型，返回<code>x.valueOf()</code></li>\n<li>如果<code>x.valueOf()</code>返回值不是基本类型，且 x.toString()返回值为基本类型，返回<code>x.toString()</code></li>\n<li>\n<p>以上皆不满足，抛出<code>TypeError</code>异常</p>\n<blockquote>\n<p>注：根据 ECMA，对象到基本类型转换实际过程较复杂，以后单独写一篇</p>\n</blockquote>\n</li>\n</ol>\n<h4 id=\"题目解析\"><a href=\"#%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90\" aria-label=\"题目解析 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>题目解析</h4>\n<p><strong>题 1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//''</span></code></pre></div>\n<p>分析：</p>\n<ul>\n<li>均为对象，先将其转换为基本类型，根据对象转换规则，数组首先调用 valueOf()，返回值为自身，继续调用 toString()，返回空字符串''，表达式变为''+''</li>\n<li>根据+规则-2，执行字符串拼接，表达式返回结果''</li>\n</ul>\n<p><strong>题 2</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//'[object Object]'</span></code></pre></div>\n<p>分析：</p>\n<ul>\n<li>均为对象，先将其转换为基本类型，根据对象转换规则，首先调用<code>valueOf()</code>，返回值为自身，继续调用<code>toString()</code>，返回空字符串<code>''</code>和<code>'[object Object]'</code>，表达式变为<code>''+'[object Object]'</code></li>\n<li>根据+规则-2，执行字符串拼接，表达式返回结果<code>'[object Object]'</code></li>\n</ul>\n<p><strong>题 3</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">+</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//0</span></code></pre></div>\n<p>分析：</p>\n<ul>\n<li>因浏览器将<code>{}</code>解析为代码块<sup><a href=\"#%E6%B3%A81\">注[1]</a></sup>，表达式等价于<code>+[]</code>,先将其转换为基本类型，根据对象转换规则，数组首先调用<code>valueOf()</code>，返回值为自身，继续调用<code>toString()</code>，返回空字符串<code>''</code>，表达式变为<code>+''</code>,取<code>Number('')</code>，表达式返回<code>0</code></li>\n<li>如果将表达式改写为<code>({})+[]</code>，将得到与题 2 相同的结果</li>\n</ul>\n<p><strong>题 4</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//'[object Object][object Object]'</span></code></pre></div>\n<p>分析：</p>\n<ul>\n<li>这道题比较奇怪</li>\n<li>按照题 3 的规则，第一个<code>{}</code>将被解析为代码块，表达式等效于<code>+{}</code>，按照对象转换规则，先变成<code>+'[object Object]'</code>，然后取<code>Number('[object Object]')</code>，应该返回结果<code>NaN</code>才对。<code>FireFox 62</code>，<code>Edge</code>，<code>IE11</code>的输出就是这个。</li>\n<li>可是输入<code>Chrome 69</code>，二者都是被当作对象处理的，最终表达式返回结果<code>'[object Object][object Object]'</code></li>\n<li>看来几家浏览器在这种情况下规则有所不同，深入研究需要看<code>parser</code>里的抽象语法树<code>Abstract Syntax Tree(AST)</code> 是如何解析的，以后有时间了再研究</li>\n</ul>\n<hr>\n<p>下面对题 4 做一点扩展，算作验证<br>\n<strong>题 4-扩展</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token number\">1.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>   <span class=\"token comment\">//Chrome  - '[object Object][object Object]'</span>\n             <span class=\"token comment\">//FireFox - '[object Object][object Object]'</span>\n             <span class=\"token comment\">//IE 11   - '[object Object][object Object]'</span>\n             <span class=\"token comment\">//Edge    - '[object Object][object Object]'</span>\n\n<span class=\"token number\">2.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//Chrome  - NaN</span>\n             <span class=\"token comment\">//FireFox - NaN</span>\n             <span class=\"token comment\">//IE 11   - NaN</span>\n             <span class=\"token comment\">//Edge    - NaN</span>\n\n<span class=\"token number\">3.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  <span class=\"token comment\">//Chrome  - '[object Object][object Object][object Object]'</span>\n             <span class=\"token comment\">//FireFox - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//IE 11   - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//Edge    - 'NaN[object Object]'</span>\n\n<span class=\"token number\">4.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token comment\">//Chrome  - '[object Object][object Object][object Object]'</span>\n             <span class=\"token comment\">//FireFox - '[object Object][object Object][object Object]'</span>\n             <span class=\"token comment\">//IE 11   - '[object Object][object Object][object Object]'</span>\n             <span class=\"token comment\">//Edge    - '[object Object][object Object][object Object]'</span>\n\n<span class=\"token number\">5.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token comment\">//Chrome  - '[object Object][object Object][object Object]'</span>\n             <span class=\"token comment\">//FireFox - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//IE 11   - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//Edge    - 'NaN[object Object]'</span>\n\n<span class=\"token number\">6.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//Chrome  - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//FireFox - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//IE 11   - 'NaN[object Object]'</span>\n             <span class=\"token comment\">//Edge    - 'NaN[object Object]'</span>\n\n<span class=\"token number\">7.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  <span class=\"token comment\">//Chrome  - '[object Object][object Object]'</span>\n             <span class=\"token comment\">//FireFox - '0[object Object]'</span>\n             <span class=\"token comment\">//IE 11   - '0[object Object]'</span>\n             <span class=\"token comment\">//Edge    - '0[object Object]'</span>\n\n<span class=\"token number\">8.</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">+</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">//Chrome  - 'NaN'</span>\n             <span class=\"token comment\">//FireFox - 'NaN'</span>\n             <span class=\"token comment\">//IE 11   - 'NaN'</span>\n             <span class=\"token comment\">//Edge    - 'NaN'</span></code></pre></div>\n<p>看起来似乎<code>Chrome</code>对以<code>{}</code>开头且以<code>{}</code>结尾(即<code>'{}+...+{}'</code>) 的表达式做了优化解析，不会把遇见的<code>{}</code>视为代码块，而是作为空对象解析。其他浏览器没有这个规则。</p>\n<hr>\n<h6 id=\"---omit-in-toc---注-1\"><a href=\"#---omit-in-toc---%E6%B3%A8-1\" aria-label=\"   omit in toc   注 1 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><!-- omit in toc -->注 1</h6>\n<blockquote>\n<p><strong>Expression Statement</strong>\n<strong>Syntax</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">ExpressionStatement<span class=\"token punctuation\">[</span>Yield<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span>\n       <span class=\"token punctuation\">[</span>lookahead ∉ <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> Expression<span class=\"token punctuation\">[</span>In<span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span>Yield<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>NOTE\n<strong><em>An ExpressionStatement cannot start with a U+007B (LEFT CURLY BRACKET) because that might make it ambiguous with a Block.</em></strong> Also, an ExpressionStatement cannot start with the function or class keywords because that would make it ambiguous with a FunctionDeclaration, a GeneratorDeclaration, or a ClassDeclaration. An ExpressionStatement cannot start with the two token sequence let [ because that would make it ambiguous with a let LexicalDeclaration whose first LexicalBinding was an ArrayBindingPattern.</p>\n</blockquote>\n</blockquote>","frontmatter":{"date":"September 18, 2018","title":"加法操作符","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABwkC0D//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAICAwAAAAAAAAAAAAAAAAERACAhMUH/2gAIAQEAAT8hQT3McFf/2gAMAwEAAgADAAAAEDDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBAAAgEFAQAAAAAAAAAAAAAAAREAECExUWFx/9oACAEBAAE/EFAwDTvCXwelxjkZSr//2Q==","aspectRatio":1.5056179775280898,"src":"/static/9983387778f1c70c0ce32374522d12c6/9830f/post-default-bg.jpg","srcSet":"/static/9983387778f1c70c0ce32374522d12c6/1e815/post-default-bg.jpg 750w,\n/static/9983387778f1c70c0ce32374522d12c6/e7fdc/post-default-bg.jpg 1500w,\n/static/9983387778f1c70c0ce32374522d12c6/9830f/post-default-bg.jpg 3000w,\n/static/9983387778f1c70c0ce32374522d12c6/87c59/post-default-bg.jpg 4288w","sizes":"(max-width: 3000px) 100vw, 3000px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/Blog/加法操作符/","previous":{"fields":{"slug":"/Blog/相等操作符/"},"frontmatter":{"title":"相等操作符"}},"next":{"fields":{"slug":"/Blog/JS中的隐式转换/"},"frontmatter":{"title":"JS中的隐式转换"}}}}}